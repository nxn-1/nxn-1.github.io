<!Doctype: HTML w/ Processing>

<html>

  <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Processing Demo</title>
      <script type="text/javascript" src="js/processing.js"></script>
  </head>
  
  <body>
    <h1>PUT YOUR TITLE HERE</h1>
    <p>ADD DESCRIPTION HERE</p>
    
    <script type="text/processing">
    
          PImage src, img, sel;
          int x, y, w, h, mX, mY;
          boolean painting = false;
          float grid = 20;

          void setup() {
          size(800, 800);
          rectMode(CORNERS);
          src = loadImage("image.png");
          src.resize(width, height);
          img = src.get();
          }

          void draw() {
          image(img, 0, 0);
          if (mousePressed) {
          mX = gridify(mouseX);
          mY = gridify(mouseY);
          if (painting) {
          int xDist = abs(mX-gridify(pmouseX));
          int yDist = abs(mY-gridify(pmouseY));
          int steps = max(xDist, yDist);
          for (int i=0; i<steps; i++) {
          float lerpX = lerp(gridify(pmouseX), mX, (1.0/steps)*i);
          float lerpY = lerp(gridify(pmouseY), mY, (1.0/steps)*i);
          image(sel, lerpX-(x), lerpY-(y));
          }
          img = get();
          } else {
          stroke(#FF0000);
          strokeWeight(2);
          noFill();
          rect(x, y, mX, mY);
          }
          }
          }

          void mousePressed() {
          mX = gridify(mouseX);
          mY = gridify(mouseY);
          if (!painting) {
          x = mX;
          y = mY;
          } else {
          x = mX-x;
          y = mY-y;
          }
          }

          void mouseReleased() {
          mX = gridify(mouseX);
          mY = gridify(mouseY);
          if (mX!=x && mY!=y && !painting) {
          w = abs(x-mX);
          h = abs(y-mY);
          if (mX < x) x = mX;
          if (mY < y) y = mY;
          sel = src.get(x, y, w, h);
          painting = true;
          } else {
          painting = false;
          }
          }

          void keyReleased() {
          if (keyCode == BACKSPACE) {
          img = src.get();
          painting = false;
          }
          }

          int gridify(float in) {
          int out = int(round(in/grid)*grid);
          return out;
          }

    </script>
    <canvas id="sketch" style="border: 1px solid black;"></canvas>
    
  </body>
  
</html>
